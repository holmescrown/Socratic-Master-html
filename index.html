<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>Socratic Master | 12å¹´åˆ¶å…¨åŠŸèƒ½ç”Ÿäº§ç«¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(20px); border-radius: 30px; border: 1px solid rgba(255,255,255,0.4); }
        .lang-active { background: #0071E3; color: white; }
        .mascot-evolve { transform: scale(1.1); filter: drop-shadow(0 0 10px rgba(59,130,246,0.5)); }
    </style>
</head>
<body class="bg-[#F2F2F7] p-4 md:p-10 font-sans">
    <div class="max-w-7xl mx-auto">
        <header class="flex justify-between items-center mb-10">
            <div class="flex items-center space-x-3">
                <div class="bg-black text-white p-2.5 rounded-2xl"><i class="fa-solid fa-brain"></i></div>
                <h1 class="text-2xl font-black tracking-tighter">Socratic Master <span class="text-xs font-normal opacity-30 tracking-normal">Pro v3.8</span></h1>
            </div>
            <div class="flex items-center space-x-6">
                <nav class="flex space-x-6 text-sm font-bold">
                    <button onclick="showSection('tutor')" id="tab-tutor" class="text-blue-600 border-b-2 border-blue-600 pb-1">å¯¼å¸ˆäº¤äº’</button>
                    <button onclick="showSection('report'); loadReport();" id="tab-report" class="text-gray-400 hover:text-black pb-1">å­¦ä¹ å‘¨æŠ¥</button>
                </nav>
                <div class="bg-gray-200 p-1 rounded-xl flex text-[10px] font-black shadow-inner">
                    <button id="btnZh" onclick="setLang('zh')" class="px-3 py-1 rounded-lg lang-active">ä¸­æ–‡</button>
                    <button id="btnEn" onclick="setLang('en')" class="px-3 py-1 rounded-lg">EN</button>
                </div>
                <button onclick="toggleConfig()" class="text-gray-400 hover:text-blue-600 transition text-xl"><i class="fa-solid fa-sliders"></i></button>
            </div>
        </header>

        <main id="section-tutor" class="grid grid-cols-1 lg:grid-cols-4 gap-10">
            <div class="lg:col-span-3 space-y-8">
                <div class="glass p-8 grid grid-cols-1 md:grid-cols-3 gap-8 shadow-sm">
                    <div>
                        <label class="text-[10px] font-black text-gray-400 uppercase mb-3 block tracking-widest">å­¦æ®µå­¦åˆ¶</label>
                        <select id="grade" class="w-full p-4 bg-gray-50 rounded-2xl border-none outline-none font-bold text-sm">
                            <optgroup label="å°å­¦é˜¶æ®µ">
                                <option>å°å­¦ (1-3å¹´çº§)</option><option>å°å­¦ (4-6å¹´çº§)</option>
                            </optgroup>
                            <optgroup label="ä¸­å­¦é˜¶æ®µ">
                                <option>åˆä¸­ (G7-G9)</option><option>é«˜ä¸­ (G10-G12)</option>
                            </optgroup>
                        </select>
                    </div>
                    <div>
                        <label class="text-[10px] font-black text-gray-400 uppercase mb-3 block tracking-widest">å­¦ç§‘åˆ†ç±»</label>
                        <select id="subject" class="w-full p-4 bg-gray-50 rounded-2xl border-none outline-none font-bold text-sm text-blue-600">
                            <option>æ•°å­¦ (Math)</option><option>ç‰©ç† (Physics)</option>
                            <option>åŒ–å­¦ (Chemistry)</option><option>ç”Ÿç‰© (Biology)</option>
                            <option>è¯­æ–‡ (Language)</option><option>è‹±è¯­ (English)</option>
                            <option>åœ°ç†/å†å² (Social)</option><option>ä¿¡æ¯æŠ€æœ¯ (CS)</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-[10px] font-black text-gray-400 uppercase mb-3 block tracking-widest">å­¦ç”Ÿç¼–å·</label>
                        <input id="sid" type="text" value="STUDENT_001" class="w-full p-4 bg-gray-50 rounded-2xl border-none outline-none font-mono font-bold text-sm">
                    </div>
                </div>

                <div class="glass p-10 shadow-sm relative">
                    <span class="bg-blue-100 text-blue-700 text-[10px] px-4 py-1.5 rounded-full font-black absolute top-10 left-10">LOGICAL INQUIRY</span>
                    <textarea id="quest" placeholder="æè¿°ä½ çš„é€»è¾‘çŸ›ç›¾ï¼Œå¯¼å¸ˆå°†é€šè¿‡è¿½é—®å¼•å¯¼ä½ ..." class="w-full h-48 mt-12 bg-transparent text-2xl font-light outline-none resize-none leading-relaxed"></textarea>
                    <div class="flex justify-end pt-6 border-t border-gray-100">
                        <button id="btn" onclick="ask()" class="bg-blue-600 text-white px-14 py-5 rounded-2xl font-black shadow-2xl hover:bg-blue-700 transition active:scale-95 flex items-center">
                            <span>å¯åŠ¨é€»è¾‘å¼•å¯¼</span> <i class="fa-solid fa-paper-plane ml-3"></i>
                        </button>
                    </div>
                </div>

                <div id="resArea" class="hidden space-y-8 animate-in fade-in duration-700">
                    <div class="glass p-10 border-l-8 border-blue-600">
                        <label class="text-[10px] font-black text-blue-600 uppercase mb-4 block tracking-[0.2em]">å¯¼å¸ˆå¼•å¯¼è¯­ (GUIDE)</label>
                        <p id="guide" class="text-2xl leading-relaxed text-gray-800 font-medium italic"></p>
                    </div>
                    <div class="p-10 bg-blue-50/50 rounded-[40px] border border-blue-100">
                        <label class="text-[10px] font-black text-blue-400 uppercase mb-4 block tracking-widest">æ€ç»´é“¾è¿½è¸ª (R1 THINKING)</label>
                        <div id="think" class="text-sm font-mono text-blue-900/40 whitespace-pre-wrap leading-loose"></div>
                    </div>
                </div>
            </div>

            <aside class="space-y-8">
                <div class="glass p-10 text-center shadow-sm">
                    <div id="mascot" class="text-8xl mb-6 transition-all duration-500">ğŸ±</div>
                    <div id="mascotMsg" class="text-[10px] font-black text-gray-400 uppercase tracking-tighter">é€»è¾‘ç£å¯¼å°±ç»ª</div>
                </div>

                <div class="glass p-8">
                    <h4 class="text-[10px] font-black text-gray-400 uppercase mb-6 text-center tracking-widest">ç³»ç»Ÿè¿è¡ŒçŠ¶æ€</h4>
                    <div class="space-y-4 text-[11px] font-black">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">D1 æ•°æ®åº“å­˜å‚¨</span>
                            <span id="d1Stat" class="text-green-500">â— å‡†å¤‡å°±ç»ª</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">Vector å‘é‡ç´¢å¼•</span>
                            <span id="vecStat" class="text-green-500">â— æ­£å¸¸è¿è¡Œ</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400">AI æ¨¡å‹çŠ¶æ€</span>
                            <span id="modelStat" class="text-yellow-500">â— æ£€æŸ¥ä¸­...</span>
                        </div>
                        <div class="text-[10px] text-gray-500 mt-2">
                            <span id="modelInfo">æ­£åœ¨æ£€æµ‹å½“å‰æ¨¡å‹çŠ¶æ€...</span>
                        </div>
                    </div>
                </div>

                <div class="bg-blue-600 p-8 rounded-[35px] text-white shadow-xl relative overflow-hidden">
                    <div class="absolute -right-4 -top-4 opacity-10 text-8xl"><i class="fa-solid fa-lightbulb"></i></div>
                    <h4 class="text-[10px] font-black uppercase mb-4 tracking-widest">æ“ä½œæŒ‡å¼•</h4>
                    <p class="text-[11px] leading-relaxed font-medium opacity-90">
                        1. è¾“å…¥å›°æƒ‘è€Œéæ±‚ç­”æ¡ˆã€‚<br>
                        2. è§‚å¯Ÿå³ä¾§å¯¼å¸ˆçŠ¶æ€ã€‚<br>
                        3. æ¯ä¸€ç¬”è®°å½•éƒ½å°†æ°¸ä¹…åŒæ­¥è‡³ D1ã€‚
                    </p>
                </div>
            </aside>
        </main>

        <main id="section-report" class="hidden">
            <div class="glass p-12">
                <h2 class="text-3xl font-black mb-10 flex items-center"><i class="fa-solid fa-chart-pie mr-4 text-blue-600"></i> å­¦ä¹ ç”»åƒå½’çº³</h2>
                <div id="reportContainer" class="grid grid-cols-1 md:grid-cols-2 gap-12">
                    <div class="bg-gray-50 p-8 rounded-3xl">
                        <h3 class="text-xs font-black text-gray-400 mb-6 uppercase">å­¦ç§‘ç²¾åŠ›æŠ•å…¥åˆ†å¸ƒ</h3>
                        <div id="chartArea" class="space-y-6"></div>
                    </div>
                    <div class="bg-gray-50 p-8 rounded-3xl">
                        <h3 class="text-xs font-black text-gray-400 mb-6 uppercase">AI é€»è¾‘å»ºè®®</h3>
                        <p class="text-sm leading-relaxed text-gray-600">ç³»ç»Ÿæ£€æµ‹åˆ°ä½ åœ¨ã€ç‰©ç†ã€‘ç§‘ç›®æé—®è¾ƒå¤šï¼Œå»ºè®®åŠ å¼ºåŠ›å­¦åŸºç¡€æ¦‚å¿µçš„é€»è¾‘æ¨å¯¼ã€‚</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="overlay" onclick="toggleConfig()" class="fixed inset-0 bg-black/20 hidden backdrop-blur-md z-40 transition-all"></div>
    <div id="drawer" class="fixed right-0 top-0 bottom-0 w-96 bg-white shadow-2xl z-50 p-10 transform translate-x-full transition-transform duration-500 ease-in-out">
        <div class="flex justify-between items-center mb-10 font-black">
            <h2 class="text-xl">å¯¼å¸ˆå†…æ ¸è®¾ç½®</h2>
            <button onclick="toggleConfig()"><i class="fa-solid fa-xmark text-gray-300"></i></button>
        </div>
        <div class="space-y-8">
            <div>
                <label class="text-[10px] font-black text-gray-400 mb-3 block uppercase">æ¨¡å‹æä¾›å•†</label>
                <select id="mProvider" onchange="toggleExt()" class="w-full p-4 bg-gray-50 rounded-2xl border-none font-bold text-xs">
                    <option value="cf">Cloudflare Workers AI (æ¨è)</option>
                    <option value="ext">å¤–éƒ¨ API (DeepSeek/OpenAI)</option>
                </select>
            </div>
            <div>
                <label class="text-[10px] font-black text-gray-400 mb-3 block uppercase">æ¨ç†å¼•æ“ ID</label>
                <select id="mId" class="w-full p-4 bg-gray-50 rounded-2xl border-none font-mono text-[10px]">
                    <option value="@cf/deepseek-ai/deepseek-r1-distill-qwen-32b">DeepSeek R1 (Distill-32B) - æ“…é•¿é€»è¾‘æ¨ç†</option>
                    <option value="@cf/meta/llama-3.1-8b-instruct">Llama 3.1 8B - é€šç”¨å‹è¯­è¨€æ¨¡å‹</option>
                    <option value="@cf/mistral/mistral-7b-instruct-v0.1">Mistral 7B - é«˜æ•ˆå¤šä»»åŠ¡å¤„ç†</option>
                    <option value="@cf/anthropic/claude-3-haiku-20240307">Claude 3 Haiku - é«˜è´¨é‡å“åº”</option>
                </select>
            </div>
            <div id="extFields" class="hidden space-y-4 pt-4 border-t">
                <input id="apiEp" type="text" placeholder="Endpoint URL" class="w-full p-4 bg-gray-50 rounded-2xl text-[10px]">
                <input id="apiKey" type="password" placeholder="API Key" class="w-full p-4 bg-gray-50 rounded-2xl text-[10px]">
            </div>
            <button onclick="toggleConfig()" class="w-full bg-black text-white py-5 rounded-2xl font-black shadow-lg active:scale-95 transition">ä¿å­˜å¹¶åº”ç”¨</button>
        </div>
    </div>

<script>
    // 1. æ‰©å……å®Œæ•´çš„ i18n å­—å…¸ï¼Œç¡®ä¿è¦†ç›–æ‰€æœ‰ç•Œé¢å…ƒç´ 
    const i18n = {
        zh: {
            nav_tutor: "å¯¼å¸ˆäº¤äº’", nav_report: "å­¦ä¹ å‘¨æŠ¥", label_grade: "å­¦æ®µå­¦åˆ¶", 
            label_subject: "å­¦ç§‘åˆ†ç±»", label_sid: "å­¦ç”Ÿç¼–å·", session_tag: "é€»è¾‘å¼•å¯¼ä¸­", 
            placeholder: "æè¿°ä½ çš„é€»è¾‘çŸ›ç›¾ï¼Œå¯¼å¸ˆå°†é€šè¿‡è¿½é—®å¼•å¯¼ä½ ...", send_btn: "å¯åŠ¨é€»è¾‘å¼•å¯¼",
            guide_label: "å¯¼å¸ˆå¼•å¯¼è¯­ (GUIDE)", thinking_label: "æ€ç»´é“¾è¿½è¸ª (R1 THINKING)", 
            mascot_ready: "é€»è¾‘ç£å¯¼å°±ç»ª", health_title: "ç³»ç»Ÿè¿è¡ŒçŠ¶æ€",
            stat_d1: "D1 æ•°æ®åº“å­˜å‚¨", stat_vec: "Vector å‘é‡ç´¢å¼•", usage_title: "æ“ä½œæŒ‡å¼•",
            op_1: "1. è¾“å…¥å›°æƒ‘è€Œéæ±‚ç­”æ¡ˆã€‚", op_2: "2. è§‚å¯Ÿå³ä¾§å¯¼å¸ˆçŠ¶æ€ã€‚", op_3: "3. è‡ªåŠ¨åŒæ­¥è‡³ D1ã€‚",
            config_title: "å¯¼å¸ˆå†…æ ¸è®¾ç½®", btn_save: "ä¿å­˜å¹¶åº”ç”¨", loading: "æ­£åœ¨å‘¼å« AI å¯¼å¸ˆ..."
        },
        en: {
            nav_tutor: "Tutor", nav_report: "Report", label_grade: "Grade", 
            label_subject: "Subject", label_sid: "Student ID", session_tag: "SESSION ACTIVE", 
            placeholder: "Describe your logic gap, the tutor will guide you...", send_btn: "Start Inquiry",
            guide_label: "TUTOR GUIDE", thinking_label: "THINKING PROCESS (R1)", 
            mascot_ready: "TUTOR READY", health_title: "SYSTEM STATUS",
            stat_d1: "D1 Storage", stat_vec: "Vector Index", usage_title: "GUIDE",
            op_1: "1. Inquiry, no answers.", op_2: "2. Check status.", op_3: "3. Auto-sync D1.",
            config_title: "CORE CONFIG", btn_save: "Save & Apply", loading: "Calling AI Tutor..."
        }
    };

    let curLang = 'zh';

    // 2. æ ¸å¿ƒåˆ‡æ¢å‡½æ•°ï¼šå¾ªç¯éå†æ‰€æœ‰å¸¦ data-i18n å±æ€§çš„æ ‡ç­¾è¿›è¡Œç¿»è¯‘
    function setLang(lang) {
        curLang = lang;
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (i18n[lang][key]) {
                el.innerText = i18n[lang][key];
            }
        });
        
        // å¤„ç†ç‰¹æ®Šå±æ€§ï¼šå ä½ç¬¦
        const questBox = document.getElementById('quest');
        if (questBox) questBox.placeholder = i18n[lang].placeholder;
        
        // åˆ‡æ¢æŒ‰é’®é«˜äº®æ ·å¼
        document.getElementById('btnZh').classList.toggle('lang-active', lang === 'zh');
        document.getElementById('btnEn').classList.toggle('lang-active', lang === 'en');
        
        console.log(`Language switched to: ${lang}`);
    }

    // 3. é¡µé¢åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => setLang('zh'));

    // åŸæœ‰çš„é€»è¾‘å‡½æ•°ä¿æŒä¸å˜...
    function toggleConfig() { document.getElementById('drawer').classList.toggle('translate-x-full'); document.getElementById('overlay').classList.toggle('hidden'); }
    function toggleExt() { document.getElementById('extFields').classList.toggle('hidden', document.getElementById('mProvider').value === 'cf'); }
    function showSection(name) {
        document.getElementById('section-tutor').classList.toggle('hidden', name !== 'tutor');
        document.getElementById('section-report').classList.toggle('hidden', name !== 'report');
        document.getElementById('tab-tutor').className = name === 'tutor' ? 'text-blue-600 border-b-2 border-blue-600 pb-1' : 'text-gray-400 hover:text-black pb-1';
        document.getElementById('tab-report').className = name === 'report' ? 'text-blue-600 border-b-2 border-blue-600 pb-1' : 'text-gray-400 hover:text-black pb-1';
    }

    async function ask() {
        const btn = document.getElementById('btn');
        const mascot = document.getElementById('mascot');
        btn.disabled = true; 
        btn.innerText = i18n[curLang].loading;
        mascot.innerText = "ğŸ¤”"; 

        try {
            const res = await fetch('https://socratic-tutor.whitecrow0a.workers.dev/api/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    question: document.getElementById('quest').value,
                    student_id: document.getElementById('sid').value,
                    grade: document.getElementById('grade').value,
                    subject: document.getElementById('subject').value,
                    language: curLang,
                    model_config: { model: document.getElementById('mId').value }
                })
            });
            const data = await res.json();
            document.getElementById('resArea').classList.remove('hidden');
            document.getElementById('guide').innerText = data.guide_message;
            document.getElementById('think').innerText = data.thinking;
            mascot.innerText = "ğŸ¦"; 
        } catch (e) {
            mascot.innerText = "âŒ"; 
        } finally {
            btn.disabled = false; 
            btn.innerHTML = `${i18n[curLang].send_btn} <i class="fa-solid fa-paper-plane ml-3"></i>`;
        }
    }

    async function loadReport() {
            const sid = document.getElementById('sid').value;
            const res = await fetch(`https://socratic-tutor.whitecrow0a.workers.dev/api/report?sid=${sid}`);
            const data = await res.json();
            const area = document.getElementById('chartArea');
            area.innerHTML = data.map(item => `
                <div class="space-y-2">
                    <div class="flex justify-between text-[10px] font-black"><span>${item.subject}</span><span>${item.count} æ¬¡å¯¹è¯</span></div>
                    <div class="w-full bg-gray-200 rounded-full h-2"><div class="bg-blue-600 h-2 rounded-full" style="width: ${Math.min(item.count*20, 100)}%"></div></div>
                </div>
            `).join('');
        }

        // æ¨¡å‹çŠ¶æ€æ£€æŸ¥å‡½æ•°
        async function checkModelStatus() {
            const modelId = document.getElementById('mId').value;
            const modelStat = document.getElementById('modelStat');
            const modelInfo = document.getElementById('modelInfo');
            
            modelStat.className = 'text-yellow-500';
            modelStat.innerText = 'â— æ£€æŸ¥ä¸­...';
            modelInfo.innerText = 'æ­£åœ¨æ£€æµ‹å½“å‰æ¨¡å‹çŠ¶æ€...';
            
            try {
                // å‘é€ä¸€ä¸ªç®€å•çš„æµ‹è¯•è¯·æ±‚æ¥æ£€æŸ¥æ¨¡å‹æ˜¯å¦å¯ç”¨
                const res = await fetch('https://socratic-tutor.whitecrow0a.workers.dev/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        question: 'æµ‹è¯•æ¨¡å‹å¯ç”¨æ€§',
                        student_id: 'TEST_USER',
                        grade: 'å°å­¦ (1-3å¹´çº§)',
                        subject: 'æ•°å­¦ (Math)',
                        language: 'zh',
                        model_config: { model: modelId }
                    })
                });
                
                if (res.ok) {
                    const data = await res.json();
                    modelStat.className = 'text-green-500';
                    modelStat.innerText = 'â— æ­£å¸¸è¿è¡Œ';
                    modelInfo.innerText = `å½“å‰æ¨¡å‹: ${modelId.split('/').pop()}ï¼ŒçŠ¶æ€æ­£å¸¸`;
                } else {
                    throw new Error('æ¨¡å‹å“åº”é”™è¯¯');
                }
            } catch (e) {
                modelStat.className = 'text-red-500';
                modelStat.innerText = 'â— ä¸å¯ç”¨';
                modelInfo.innerText = `æ¨¡å‹ ${modelId.split('/').pop()} åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®`;
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æ¨¡å‹çŠ¶æ€
        window.onload = function() {
            checkModelStatus();
        };

        // å½“æ¨¡å‹é€‰æ‹©å˜åŒ–æ—¶é‡æ–°æ£€æŸ¥çŠ¶æ€
        document.getElementById('mId').addEventListener('change', function() {
            checkModelStatus();
        });
</script>
</body>
</html>